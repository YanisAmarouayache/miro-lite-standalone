<div
  #canvasRoot
  class="canvas"
  (click)="canvasClick.emit()"
  (wheel)="canvasWheel.emit($event)"
  (contextmenu)="canvasContextMenu.emit($event)"
  (dragover)="onCanvasDragOver($event)"
  (drop)="onCanvasDrop($event)"
>
  <div
    *ngIf="zoomIndicatorVisible"
    class="zoom-indicator"
    [style.left.px]="zoomIndicatorX"
    [style.top.px]="zoomIndicatorY"
  >
    {{ (zoom * 100) | number:'1.0-0' }}%
  </div>

  <div
    class="canvas-scroll-space"
    [style.width.px]="surfaceWidth() * zoom"
    [style.height.px]="surfaceHeight() * zoom"
  ></div>

  <div
    class="canvas-surface"
    [style.width.px]="surfaceWidth()"
    [style.height.px]="surfaceHeight()"
    [style.transform]="'scale(' + zoom + ')'"
  >
    <article
      class="widget"
      [class.widget-yellow-box]="w.type === 'text'"
      [class.widget-textual]="w.type === 'text' || w.type === 'textarea'"
      [class.widget-selected]="isSelected(w.id)"
      *ngFor="let w of widgets; trackBy: trackByWidgetId"
      [style.left.px]="frame(w).x"
      [style.top.px]="frame(w).y"
      [style.width.px]="frame(w).width"
      [style.height.px]="frame(w).height"
      (click)="selectWidget.emit(w.id); $event.stopPropagation()"
      (mousedown)="requestDrag(w.id, $event)"
      (contextmenu)="onWidgetContextMenu(w.id, $event)"
    >
      <div class="drag-surface" (mousedown)="requestDrag(w.id, $event)"></div>

      <div class="widget-content" [ngSwitch]="w.type">
        <textarea
          *ngSwitchCase="'text'"
          class="inline-yellow-editor"
          [ngModel]="textValue(w)"
          [readonly]="!editable"
          (mousedown)="onEditableMouseDown(w.id, $event)"
          (ngModelChange)="updateText.emit({ widgetId: w.id, text: $event })"
        ></textarea>
        <textarea
          *ngSwitchCase="'textarea'"
          class="inline-textarea-editor"
          [ngModel]="textValue(w)"
          [readonly]="!editable"
          (mousedown)="onEditableMouseDown(w.id, $event)"
          (ngModelChange)="updateText.emit({ widgetId: w.id, text: $event })"
        ></textarea>
        <div *ngSwitchCase="'chart'" class="chart-widget">
          <p>Chart: {{ chartType(w) }}</p>
        </div>
        <div *ngSwitchCase="'counter'" class="counter-widget">
          <p>{{ counterLabel(w) }}</p>
          <h2>{{ counterValue(w) }}</h2>
        </div>
        <div *ngSwitchCase="'table'" class="table-widget">
          <p>Table widget</p>
        </div>
        <div *ngSwitchCase="'image'" class="image-widget">
          <img *ngIf="imageSrc(w)" [src]="imageSrc(w)" [alt]="imageAlt(w)" draggable="false" />
          <p *ngIf="!imageSrc(w)">No image yet</p>
        </div>
      </div>

      <button type="button" class="resize-handle resize-n" [disabled]="!editable" (mousedown)="requestResize(w, 'n', $event)"></button>
      <button type="button" class="resize-handle resize-s" [disabled]="!editable" (mousedown)="requestResize(w, 's', $event)"></button>
      <button type="button" class="resize-handle resize-e" [disabled]="!editable" (mousedown)="requestResize(w, 'e', $event)"></button>
      <button type="button" class="resize-handle resize-w" [disabled]="!editable" (mousedown)="requestResize(w, 'w', $event)"></button>
      <button type="button" class="resize-handle resize-ne" [disabled]="!editable" (mousedown)="requestResize(w, 'ne', $event)"></button>
      <button type="button" class="resize-handle resize-nw" [disabled]="!editable" (mousedown)="requestResize(w, 'nw', $event)"></button>
      <button type="button" class="resize-handle resize-se" [disabled]="!editable" (mousedown)="requestResize(w, 'se', $event)"></button>
      <button type="button" class="resize-handle resize-sw" [disabled]="!editable" (mousedown)="requestResize(w, 'sw', $event)"></button>
    </article>
  </div>
</div>
